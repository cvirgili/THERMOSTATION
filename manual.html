<html>

<head>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="assets/manifest-manual.json">
    <script type="text/javascript" src="./assets/js/jquery-3.3.1.min.js"></script>
    <script src="/assets/js/socket.io.slim.js"></script>
    <script>
        const socket = io();
    </script>
    <style>
        html,
        body {
            font-size: 8vw;
            text-align: center;
            margin: 0;
            padding: 0;
            font-family: 'Courier New', Courier, monospace;
        }
        
        div {
            margin: 20px;
        }
        
        button {
            font-size: 6vw;
            width: 30vh;
            height: 30vh;
            background: black;
            border-style: none;
            border-radius: 50%;
            padding: 0;
            color: green;
        }
        
        .bg-image {
            background-position: center;
            background-size: 50%;
            background-repeat: no-repeat;
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            padding: 0;
        }
        
        .off {
            background-image: url('/assets/images/off.jpg');
        }
        
        .on {
            background-image: url('/assets/images/on.jpg');
        }
        
        .popup {
            margin: 0;
            width: 100%;
            height: 100%;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.589);
            padding-top: 30%;
            /* display: none; */
        }
        
        .close {
            width: 25px;
            height: 25px;
            position: absolute;
            right: 0;
            top: 0;
            margin: 0;
            padding: 0;
            background: red;
            color: white;
            display: block;
            font-size: 20px;
            cursor: pointer;
            z-index: 200;
        }
        
        .noselect {
            -webkit-touch-callout: none;
            /* iOS Safari */
            -webkit-user-select: none;
            /* Safari */
            -khtml-user-select: none;
            /* Konqueror HTML */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* Internet Explorer/Edge */
            user-select: none;
            /* Non-prefixed version, currently
                                  supported by Chrome and Opera */
        }
    </style>
</head>

<body>
    <div class="popup">
        <div class="noselect close" onclick="closeinstall()">X</div>
        <button onclick="install()">install</button>
    </div>
    <h1>iHome</h1>
    <div><button id="relayStatus" onclick="relayOnOff()"><span class="bg-image off"></span></button></div>
    <div><button id="scheduler" onclick="startScheduler()">SCHEDULER</button></div>
    <div id="msg"></div>
    <script>
        //var schedulerStatus = 0;
        var relayStatus = 0;

        function startScheduler() {
            //if (schedulerStatus == 1) return;
            $.get("/startscheduler", console.log).fail(failMsg);
        }

        function relayOnOff() {
            relayStatus = relayStatus == 0 ? 1 : 0;
            console.log("relayStatus", relayStatus);
            $.get("/setboiler/" + relayStatus).fail(failMsg);
        }

        function setStatus(status) {
            relayStatus = status.relay;
            //schedulerStatus = status.scheduler;
            console.log("status", status);
            $("#msg").text('');
            $('#relayStatus>span').removeClass("on off").addClass("bg-image").addClass(status.relay == 1 ? "on" : "off");
            $('#scheduler').css({
                "color": status.scheduler == 1 ? "green" : "red"
            });
            $('#scheduler').text(status.scheduler == 1 ? "SCHEDULER" : "MANUAL MODE");
        }

        function failMsg() {
            socket.close();
            $("#msg").text('no connection!');
        }

        function closeinstall() {
            $(".popup").hide(0);
        };
        // function checkStatus() {
        //     $.get('/getstatus', setStatus).fail(failMsg);
        // }

        socket.on('connect', console.log);
        socket.on('disconnect', failMsg);
        socket.on('close', failMsg);
        socket.on('error', failMsg);
        socket.on('status', setStatus);
        socket.on('prestatus', setStatus);

        //$(checkStatus);
    </script>
    <script type="text/javascript" src="assets/js/sw-init.js"></script>

</body>

</html>